<div id = "categories">
  <ul id='category_list'>
    <h3>Categories</h3>
      <% @categories.each do |category| %>
        <li><a href="#" id="<%= category.title %>" class="filter" data-no-turbolink><%= category.title %></a>
        </li>
    <% end %>
  </ul>
</div>

<h1>All Items</h1>

<div id="masonry-grid">
  <div class="grid-sizer">
      <% @items.each do |item| %>
        <div class="grid-item <%= item.categories.reduce('') { |sum, category| sum + category.title + ' '}.strip %>" id="item_<%= item.id %>">
          <%= link_to image_tag(item.image(:medium)), photo_path(item.business.slug, item) %>
          <span class="item_title"><%= item.title %><span><%= number_to_currency(item.price) %>
          <%= item.description %>

          <%= form_tag line_items_path do %>
            <%= number_field :quantity, "quantity", in: 1..20, value: 1 %>
            <%= hidden_field_tag :id, item.id %>
            <a href="#" class="btn btn-default disabled" role=""><%= number_to_currency(item.price) %></a>
            <%= submit_tag "Add to Cart", class: "btn btn-success" %>
          <% end %>
        </div>
      <% end %>

  </div>
</div>



<script>
  var container = document.querySelector('#masonry-grid');
  var msnry = new Masonry( container, {
    columnWidth: ".grid-sizer",
    itemSelector: '.grid-item'
  });
  imagesLoaded( container, function() {
    msnry.layout();
  });
  $('.filter').on('click', function () {
      $(this).toggleClass('pressed');
      filterItems();
      msnry.layout();
  });
  function filterItems() {
    $('.grid-item').removeClass('off');
    $('.pressed').each(function() {
      var category = $(this).attr('id');
      $('.grid-item').each(function() {
        if (!$(this).hasClass(category)) {
          $(this).addClass('off');
        }
      });
    });
  }
</script>
